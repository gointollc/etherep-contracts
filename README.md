# etherep-contracts
Ethereum smart contracts for etherep

## Deploying With Geth

    var manager = web3.eth.accounts[0];
    var fee = 200000000000000;

    var etherepABI = [{"constant":false,"inputs":[{"name":"d","type":"bool"}],"name":"setDebug","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"drain","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"who","type":"address"}],"name":"getScoreAndCount","outputs":[{"name":"score","type":"int256"},{"name":"ratings","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"who","type":"address"}],"name":"setManager","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getDebug","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"who","type":"address"}],"name":"getScore","outputs":[{"name":"score","type":"int256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getManager","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"who","type":"address"},{"name":"rating","type":"int256"}],"name":"rate","outputs":[],"payable":true,"type":"function"},{"inputs":[{"name":"_manager","type":"address"},{"name":"_fee","type":"uint256"},{"name":"_storageAddress","type":"address"},{"name":"_wait","type":"uint256"}],"payable":false,"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"sender","type":"address"},{"indexed":false,"name":"message","type":"string"}],"name":"Error","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"message","type":"string"}],"name":"Debug","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"message","type":"int256"}],"name":"DebugInt","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"message","type":"uint256"}],"name":"DebugUint","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"by","type":"address"},{"indexed":false,"name":"who","type":"address"},{"indexed":false,"name":"rating","type":"int256"}],"name":"Rating","type":"event"}];

    var etherepBytes = "0x6060604052341561000c57fe5b604051608080610b1483398101604090815281516020830151918301516060909301519092905b60008054600185905560028054600160a060020a031916600160a060020a0386811691909117909155600384905561010060a860020a0319909116610100918716919091021760ff191690555b505050505b610a80806100946000396000f3006060604052361561008b5763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416630c2cb820811461008d5780639890220b146100a4578063ab413a7e146100b6578063d0ebdbe7146100eb578063d184935d14610109578063d47875d01461012d578063d50095841461015b578063e7e3e16714610187575bfe5b341561009557fe5b6100a260043515156101a0565b005b34156100ac57fe5b6100a2610233565b005b34156100be57fe5b6100d2600160a060020a036004351661030a565b6040805192835260208301919091528051918290030190f35b34156100f357fe5b6100a2600160a060020a0360043516610433565b005b341561011157fe5b6101196104e5565b604080519115158252519081900360200190f35b341561013557fe5b610149600160a060020a03600435166104ef565b60408051918252519081900360200190f35b341561016357fe5b61016b610619565b60408051600160a060020a039092168252519081900360200190f35b6100a2600160a060020a036004351660243561062e565b005b600054600160a060020a036101009091048116903316811461021f5760408051600160a060020a0333168152602081018290526006818301527f44656e696564000000000000000000000000000000000000000000000000000060608201529051600080516020610a358339815191529181900360800190a160006000fd5b6000805460ff19168315151790555b5b5050565b600054600160a060020a03610100909104811690331681146102b25760408051600160a060020a0333168152602081018290526006818301527f44656e696564000000000000000000000000000000000000000000000000000060608201529051600080516020610a358339815191529181900360800190a160006000fd5b6000600160a060020a03301631116102ca5760006000fd5b60008054604051600160a060020a03610100909204821692309092163180156108fc0292909190818181858888f19350505050151561030557fe5b5b5b50565b60025460408051600090820181905281517fc2bc2efc000000000000000000000000000000000000000000000000000000008152600160a060020a0385811660048301528351929485949116928492849263c2bc2efc9260248084019382900301818787803b151561037857fe5b6102c65a03f1151561038657fe5b5050604051805160208083015196509093507f341905673a2abf111ea058ea9b66bc53e8da9cc34d6d510ee5679c14c6b5f007925090a1604080516020808252600a908201527f43756d756c6174697665000000000000000000000000000000000000000000008183015290517f7cdb51e9dbbc205231228146c3246e7f914aa6d4a33170e43ecc8e3593481d1a9181900360600190a1828181151561042857fe5b0593505b5050915091565b600054600160a060020a03610100909104811690331681146104b25760408051600160a060020a0333168152602081018290526006818301527f44656e696564000000000000000000000000000000000000000000000000000060608201529051600080516020610a358339815191529181900360800190a160006000fd5b6000805474ffffffffffffffffffffffffffffffffffffffff001916610100600160a060020a038516021790555b5b5050565b60005460ff165b90565b60025460408051600090820181905281517fc2bc2efc000000000000000000000000000000000000000000000000000000008152600160a060020a03858116600483015283519294169284928392859263c2bc2efc9260248084019382900301818787803b151561055c57fe5b6102c65a03f1151561056a57fe5b505060405180516020808301519195509093507f341905673a2abf111ea058ea9b66bc53e8da9cc34d6d510ee5679c14c6b5f007925090a1604080516020808252600a908201527f43756d756c6174697665000000000000000000000000000000000000000000008183015290517f7cdb51e9dbbc205231228146c3246e7f914aa6d4a33170e43ecc8e3593481d1a9181900360600190a1808281151561060d57fe5b0593505b505050919050565b6000546101009004600160a060020a03165b90565b60006000600060006000600060006000600060009054906101000a900460ff1615801561067a5750600354600160a060020a033316600090815260046020526040902054429190910390115b156106e25760408051600160a060020a0333168152602081018290526010818301527f526174696e6720746f6f206f6674656e0000000000000000000000000000000060608201529051600080516020610a358339815191529181900360800190a160006000fd5b60015434101561074f5760408051600160a060020a033316815260208101829052600c818301527f466565207265717569726564000000000000000000000000000000000000000060608201529051600080516020610a358339815191529181900360800190a160006000fd5b600589138061075f575060041989125b156107c75760408051600160a060020a033316815260208101829052600d818301527f4f7574206f6620626f756e64730000000000000000000000000000000000000060608201529051600080516020610a358339815191529181900360800190a160006000fd5b33600160a060020a03168a600160a060020a031614156108445760408051600160a060020a033316815260208101829052600b818301527f53656c6620726174696e6700000000000000000000000000000000000000000060608201529051600080516020610a358339815191529181900360800190a160006000fd5b600254600160a060020a0316975060009650606495508894508685121561086c578860000394505b60408051600090820181905281517fc2bc2efc000000000000000000000000000000000000000000000000000000008152600160a060020a03338116600483015283519295508b169263c2bc2efc9260248084019382900301818887803b15156108d257fe5b6102c65a03f115156108e057fe5b50506040518051602090910151909550935050831561090e57826064028481151561090757fe5b0560640291505b60008213156109335785600a866005855b050281151561092a57fe5b05019650610937565b8596505b50600160a060020a033381166000818152600460209081526040918290204290558151928352928c169282019290925289880281830181905291517f5df952557c4acd5185f164dba741f992b65e22830c4a5f2092349fb350bf3f339181900360600190a187600160a060020a0316635cd60dad8b836040518363ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018083600160a060020a0316600160a060020a0316815260200182815260200192505050600060405180830381600087803b1515610a1457fe5b6102c65a03f11515610a2257fe5b5050505b5b5b505050505050505050505600cfa5f641c29090a64bc13dcafdc8c23d82677807046c35d636ca9c57fc9cb257a165627a7a72305820e4ea0af43ef684712146d2dc91d7c89964c19554c479f560fd262eb16258e8e30029";

    var ratingstoreABI = [{"constant":false,"inputs":[{"name":"_debug","type":"bool"}],"name":"setDebug","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getController","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"target","type":"address"},{"name":"wScore","type":"int256"}],"name":"add","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"target","type":"address"}],"name":"reset","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"target","type":"address"},{"name":"cumulative","type":"int256"},{"name":"total","type":"uint256"}],"name":"set","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"newController","type":"address"}],"name":"setController","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"target","type":"address"}],"name":"get","outputs":[{"name":"","type":"int256"},{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"newManager","type":"address"}],"name":"setManager","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getDebug","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getManager","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"inputs":[{"name":"_manager","type":"address"},{"name":"_controller","type":"address"}],"payable":false,"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"message","type":"string"}],"name":"Debug","type":"event"}];

    var ratingstoreBytes = "0x6060604052341561000c57fe5b60405160408061075c8339810160405280516020909101515b60028054600160a060020a03808516600160a060020a03199283161790925560038054928416929091169190911790556000805460ff191690555b50505b6106ea806100726000396000f300606060405236156100a15763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416630c2cb82081146100a35780633018205f146100ba5780635cd60dad146100e65780636b8ab97d146101075780637223cd191461012557806392eefe9b14610149578063c2bc2efc14610167578063d0ebdbe71461019c578063d184935d146101ba578063d5009584146101de575bfe5b34156100ab57fe5b6100b8600435151561020a565b005b34156100c257fe5b6100ca610281565b60408051600160a060020a039092168252519081900360200190f35b34156100ee57fe5b6100b8600160a060020a0360043516602435610291565b005b341561010f57fe5b6100b8600160a060020a036004351661038b565b005b341561012d57fe5b6100b8600160a060020a0360043516602435604435610443565b005b341561015157fe5b6100b8600160a060020a0360043516610537565b005b341561016f57fe5b610183600160a060020a03600435166105c8565b6040805192835260208301919091528051918290030190f35b34156101a457fe5b6100b8600160a060020a03600435166105f3565b005b34156101c257fe5b6101ca610684565b604080519115158252519081900360200190f35b34156101e657fe5b6100ca61068e565b60408051600160a060020a039092168252519081900360200190f35b600254600160a060020a03908116903316811461026d5760005460ff16156102675760408051602080825260069082015260d260020a6511195b9a59590281830152905160008051602061069f8339815191529181900360600190a15b60006000fd5b6000805460ff19168315151790555b5b5050565b600354600160a060020a03165b90565b60025433600160a060020a039081169116148015906102bf575060025432600160a060020a03908116911614155b80156102da575060035433600160a060020a03908116911614155b156102e55760006000fd5b600160a060020a03821660009081526001602052604090205460ff1615156103575760408051606081018252600180825260006020808401828152848601838152600160a060020a038916845291849052949091209251835460ff191690151517835592519082015590516002909101555b600160a060020a0382166000908152600160208190526040909120808201805484019055600201805490910190555b5b5050565b600254600160a060020a0390811690331681146103ee5760005460ff16156102675760408051602080825260069082015260d260020a6511195b9a59590281830152905160008051602061069f8339815191529181900360600190a15b60006000fd5b60408051606081018252600180825260006020808401828152848601838152600160a060020a038916845291849052949091209251835460ff191690151517835592519082015590516002909101555b5b5050565b60025433600160a060020a03908116911614801590610471575060025432600160a060020a03908116911614155b801561048c575060035433600160a060020a03908116911614155b156104975760006000fd5b600160a060020a03831660009081526001602052604090205460ff1615156105095760408051606081018252600180825260006020808401828152848601838152600160a060020a038a16845291849052949091209251835460ff191690151517835592519082015590516002909101555b600160a060020a03831660009081526001602081905260409091209081018390556002018190555b5b505050565b600254600160a060020a03908116903316811461059a5760005460ff16156102675760408051602080825260069082015260d260020a6511195b9a59590281830152905160008051602061069f8339815191529181900360600190a15b60006000fd5b6003805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0384161790555b5b5050565b600160a060020a0381166000908152600160208190526040909120908101546002909101545b915091565b600254600160a060020a0390811690331681146106565760005460ff16156102675760408051602080825260069082015260d260020a6511195b9a59590281830152905160008051602061069f8339815191529181900360600190a15b60006000fd5b6002805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0384161790555b5b5050565b60005460ff165b90565b600254600160a060020a03165b9056007cdb51e9dbbc205231228146c3246e7f914aa6d4a33170e43ecc8e3593481d1aa165627a7a7230582086547d84ab205b3f3c44864bf45c8fa8f5546e8ae9cb08251bc59c9d79a3d2470029";

    // Deploy RatingStore
    var contractRatingStore = web3.eth.contract(ratingstoreABI);
    personal.unlockAccount(manager)
    var rsDeploy = contractRatingStore.new(manager, manager, {from: manager, data: ratingstoreBytes, gas: 600000});
    var rsAddress = eth.getTransactionReceipt(rsDeploy.transactionHash).contractAddress;
    var store = contractRatingStore.at(rsAddress);

    // Deploy Etherep
    var contractEtherep = web3.eth.contract(etherepABI);
    var eDeploy = contractEtherep.new(manager, fee, rsAddress, 3600, {from: manager, data: etherepBytes, gas: 900000});
    var eAddress = eth.getTransactionReceipt(eDeploy.transactionHash).contractAddress;
    var rep = contractEtherep.at(eAddress);

    // Let RatingStore know of the address for Etherep
    var trans = store.setController(eAddress, {from: manager, gas: 200000})
    eth.getTransactionReceipt(trans);

    var migrationABI = [{"constant":true,"inputs":[{"name":"who","type":"address"}],"name":"getPermissions","outputs":[{"name":"","type":"bool"},{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"adminAddress","type":"address"}],"name":"removeAdmin","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"manAddress","type":"address"}],"name":"addManager","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"key","type":"string"}],"name":"getContract","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"key","type":"string"},{"name":"contractAddress","type":"address"}],"name":"setContract","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"adminAddress","type":"address"}],"name":"addAdmin","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"manAddress","type":"address"}],"name":"removeManager","outputs":[],"payable":false,"type":"function"},{"inputs":[{"name":"originalAdmin","type":"address"}],"payable":false,"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"by","type":"address"},{"indexed":false,"name":"key","type":"string"},{"indexed":false,"name":"contractAddress","type":"address"}],"name":"EventSetContract","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"by","type":"address"},{"indexed":false,"name":"admin","type":"address"}],"name":"EventAddAdmin","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"by","type":"address"},{"indexed":false,"name":"admin","type":"address"}],"name":"EventRemoveAdmin","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"by","type":"address"},{"indexed":false,"name":"manager","type":"address"}],"name":"EventAddManager","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"by","type":"address"},{"indexed":false,"name":"manager","type":"address"}],"name":"EventRemoveManager","type":"event"}];

    var migrationBytes = "0x6060604052341561000c57fe5b60405160208061077883398101604052515b604080516060810182526001808252602080830191825233600160a060020a0390811684860190815286821660009081529283905294909120925183549251945160ff199093169015151761ff00191661010094151594909402939093176201000060b060020a0319166201000091909316029190911790555b505b6106cf806100a96000396000f300606060405236156100805763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663160a792581146100825780631785f53c146100b95780632d06177a146100d757806335817773146100f55780633f0ed0df1461012c5780637048027514610157578063ac18de4314610175575bfe5b341561008a57fe5b61009e600160a060020a0360043516610193565b60408051921515835290151560208301528051918290030190f35b34156100c157fe5b6100d5600160a060020a03600435166101be565b005b34156100df57fe5b6100d5600160a060020a03600435166102c4565b005b34156100fd57fe5b61011060048035602481019101356103ad565b60408051600160a060020a039092168252519081900360200190f35b341561013457fe5b6100d56024600480358281019291013590600160a060020a039035166103e7565b005b341561015f57fe5b6100d5600160a060020a03600435166104d3565b005b341561017d57fe5b6100d5600160a060020a03600435166105bd565b005b600160a060020a03811660009081526020819052604090205460ff808216916101009004165b915091565b600160a060020a03331660009081526020819052604090205460ff1615156001146101e95760006000fd5b33600160a060020a031681600160a060020a031614156102095760006000fd5b604080516060810182526000808252602080830182815233600160a060020a0390811685870181815288831680875286865295889020965187549451915160ff199095169015151761ff001916610100911515919091021775ffffffffffffffffffffffffffffffffffffffff0000191662010000939092169290920217909355835192835282015281517f679e5977d69249a86f9309ca8028c56a88009f7031ca2cec23876e02ef38584b929181900390910190a15b5b50565b600160a060020a03331660009081526020819052604090205460ff1615156001146102ef5760006000fd5b6040805160608101825260008082526001602080840191825233600160a060020a0390811685870181815288831680875286855295889020965187549551915160ff199096169015151761ff001916610100911515919091021775ffffffffffffffffffffffffffffffffffffffff000019166201000094909216939093021790935583519081529182015281517fe246f71a09a58bfa511362f24d6644c13937d25452b854b93cace4ce1e20fcc4929181900390910190a15b5b50565b6000600183836040518083838082843790910194855250506040519283900360200190922054600160a060020a0316925050505b92915050565b600160a060020a03331660009081526020819052604090205460ff6101009091041615156001146104185760006000fd5b8060018484604051808383808284379190910194855250506040805160209481900385018120805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a039788161790553380871682529587169181019190915260609381018481529381018790527f81915a67322394b546737ecf7eab9df1cdf51f301d05c3546605581068ec1ec3949388935087925086919060808201858580828437604051920182900397509095505050505050a15b5b505050565b600160a060020a03331660009081526020819052604090205460ff1615156001146104fe5760006000fd5b6040805160608101825260018082526020808301918252600160a060020a0333811684860181815287831660008181528086528890209651875496519251909416620100000275ffffffffffffffffffffffffffffffffffffffff0000199215156101000261ff001995151560ff199098169790971794909416959095171691909117909355835192835282015281517eb767fad7cbc21799057b0422cf4a159a1b3d9b692a42740481ec90a48d3c73929181900390910190a15b5b50565b600160a060020a03331660009081526020819052604090205460ff1615156001146105e85760006000fd5b604080516060810182526000808252602080830182815233600160a060020a0390811685870181815288831680875286865295889020965187549451915160ff199095169015151761ff001916610100911515919091021775ffffffffffffffffffffffffffffffffffffffff0000191662010000939092169290920217909355835192835282015281517f6fb99dfbaecaffbd00b6e5345286861110433633dd0b1c4059be914c05558824929181900390910190a15b5b505600a165627a7a723058209aaf5fcdcf0b5adfc32a031712ee2cbf4637f64f7348dfd29f2ffc413e90dd9b0029";

    // Deploy migration contract
    var contractMigrate = web3.eth.contract(migrationABI);
    var mDeploy = contractMigrate.new(manager, {from: manager, data: migrationBytes, gas: 800000});
    var mAddress = eth.getTransactionReceipt(mDeploy.transactionHash).contractAddress;
    var migrate = contractMigrate.at(mAddress);

    // Set contract addresses in the migration contract
    var setTrans = migrate.setContract("etherep", rep.address);
    eth.getTransactionReceipt(setTrans)
    var setTrans = migrate.setContract("ratingstore, store.address");
    eth.getTransactionReceipt(setTrans)